{"version":3,"file":"index.cjs","sources":["../webview-src/index.ts"],"sourcesContent":["import CryptoJS from 'crypto-js'\n\n/**\n * @method toConstantCase\n * @description: 切换为常量命名\n * @example: `can.i.reset.merchant_config.app_secret` => `CAN_I_RESET_MERCHANT_CONFIG_APP_SECRET`\n * @param value\n */\nexport const toConstantCase = (value: string): string => {\n  return value.toUpperCase().replace(/[^A-Z0-9]/g, '_')\n}\n\n/**\n * @method genSignature\n * @description: 生成签名\n * @param args\n * @param signKey\n */\nexport const genSignature = (args: Record<string, any>, signKey: string): string => {\n  let result: Record<string, any> = []\n\n  // 删除签名 `sign`\n  if ('sign' in args) {\n    delete args['sign']\n  }\n\n  const addValues = (prefix: string, obj: any) => {\n    if (typeof obj === 'object' && obj !== null) {\n      if (Array.isArray(obj)) {\n        obj.forEach((val, index) => {\n          addValues(`${prefix}[${index}]`, val)\n        })\n      } else {\n        Object.keys(obj).forEach((key) => {\n          addValues(`${prefix}[${key}]`, obj[key])\n        })\n      }\n    } else {\n      if (obj !== '' && obj !== 'NULL') {\n        result.push(`${prefix}=${encodeURI(obj)}`)\n      }\n    }\n  }\n\n  Object.keys(args).forEach((key) => {\n    addValues(key, args[key])\n  })\n\n  result.sort() // 按键的字典序排序\n\n  let payload = encodeURI(result.join('&'))\n  payload = `${payload}&key=${signKey}`\n\n  // md5大写\n  return CryptoJS.MD5(payload).toString(CryptoJS.enc.Hex).toUpperCase()\n}\n\n/**\n * @method toBase64String\n * @description: 对象转base64\n * @param args\n * @param signKey\n */\nexport const toBase64String = (args: Record<string, any>, signKey: string): string => {\n  // 增加字段\n  if (!('timestamp' in args)) {\n    args = {\n      ...args,\n      timestamp: Math.ceil(new Date().getTime() / 1000).toString()\n    }\n  }\n\n  // 判断是否存在sign\n  if (!('sign' in args)) {\n    args = {\n      ...args,\n      sign: genSignature(args, signKey)\n    }\n  }\n\n  const body = JSON.stringify(args)\n  const bytes = CryptoJS.enc.Utf8.parse(body)\n\n  return CryptoJS.enc.Base64.stringify(bytes)\n}\n\n/**\n * @method decryptBase64String\n * @description: base64解密\n * @param value\n */\nexport const decryptBase64String = (value: string): Record<string, any> => {\n  const bytes = CryptoJS.enc.Base64.parse(value)\n  const body = CryptoJS.enc.Utf8.stringify(bytes)\n\n  return JSON.parse(body)\n}\n\n/**\n * @method checkSignature\n * @description: 校验签名\n * @param args\n * @param sign\n * @param signKey\n */\nexport const checkSignature = (args: Record<string, any>, sign: string, signKey: string): boolean => {\n  return genSignature(args, signKey) === sign\n}\n\n/**\n * @description [禁用debugger](https://juejin.cn/post/7000784414858805256)\n * @method disableDebugger\n */\nexport const disableDebugger = () => {\n  function block() {\n    setInterval(() => {\n      ;(function() {\n        return false\n      })\n        ['constructor']('debugger')\n        ['call']()\n    }, 50)\n  }\n\n  try {\n    block()\n  } catch (err) {\n  }\n}\n"],"names":["genSignature","args","signKey","result","addValues","prefix","obj","Array","isArray","forEach","val","index","Object","keys","key","push","encodeURI","sort","payload","join","CryptoJS","MD5","toString","enc","Hex","toUpperCase","sign","value","bytes","Base64","parse","body","Utf8","stringify","JSON","setInterval","err","timestamp","Math","ceil","Date","getTime","replace"],"mappings":"wCAQa,MAUAA,EAAe,CAACC,EAA2BC,KACtD,IAAIC,EAA8B,GAG9B,SAAUF,UACLA,EAAW,KAGpB,MAAMG,EAAY,CAACC,EAAgBC,KACd,iBAARA,GAA4B,OAARA,EACzBC,MAAMC,QAAQF,GAChBA,EAAIG,SAAQ,CAACC,EAAKC,KAChBP,EAAU,GAAGC,KAAUM,KAAUD,EAAI,IAGvCE,OAAOC,KAAKP,GAAKG,SAASK,IACxBV,EAAU,GAAGC,KAAUS,KAAQR,EAAIQ,GAAK,IAIhC,KAARR,GAAsB,SAARA,GAChBH,EAAOY,KAAK,GAAGV,KAAUW,UAAUV,KAEtC,EAGHM,OAAOC,KAAKZ,GAAMQ,SAASK,IACzBV,EAAUU,EAAKb,EAAKa,GAAK,IAG3BX,EAAOc,OAEP,IAAIC,EAAUF,UAAUb,EAAOgB,KAAK,MAIpC,OAHAD,EAAU,GAAGA,SAAehB,IAGrBkB,EAASC,IAAIH,GAASI,SAASF,EAASG,IAAIC,KAAKC,aAAa,yBAmDzC,CAACxB,EAA2ByB,EAAcxB,IAC/DF,EAAaC,EAAMC,KAAawB,8BAfLC,IAClC,MAAMC,EAAQR,EAASG,IAAIM,OAAOC,MAAMH,GAClCI,EAAOX,EAASG,IAAIS,KAAKC,UAAUL,GAEzC,OAAOM,KAAKJ,MAAMC,EAAK,0BAkBM,KAW7B,IATEI,aAAY,MACT,WACC,OAAO,CACR,GACe,YAAE,YACT,MAAG,GACX,GAKJ,CAAC,MAAOC,GACR,iDAhE2B,CAACnC,EAA2BC,KAElD,cAAeD,IACnBA,EAAO,IACFA,EACHoC,UAAWC,KAAKC,MAAK,IAAIC,MAAOC,UAAY,KAAMnB,aAKhD,SAAUrB,IACdA,EAAO,IACFA,EACHyB,KAAM1B,EAAaC,EAAMC,KAI7B,MAAM6B,EAAOG,KAAKD,UAAUhC,GACtB2B,EAAQR,EAASG,IAAIS,KAAKF,MAAMC,GAEtC,OAAOX,EAASG,IAAIM,OAAOI,UAAUL,EAAM,yBA3EdD,GACtBA,EAAMF,cAAciB,QAAQ,aAAc"}