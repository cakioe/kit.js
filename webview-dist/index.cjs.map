{"version":3,"file":"index.cjs","sources":["../webview-src/index.ts"],"sourcesContent":["import CryptoJS from 'crypto-js'\n\n/**\n * @method toConstantCase\n * @description: 切换为常量命名\n * @example: `can.i.reset.merchant_config.app_secret` => `CAN_I_RESET_MERCHANT_CONFIG_APP_SECRET`\n * @param value\n */\nexport const toConstantCase = (value: string): string => {\n  return value.toUpperCase().replace(/[^A-Z0-9]/g, '_')\n}\n\n/**\n * @method genSignature\n * @description: 生成签名\n * @param args\n * @param signKey\n */\nexport const genSignature = (args: Record<string, any>, signKey: string, prefix = ''): string => {\n  let result = []\n\n  // 删除签名 `sign`\n  if ('sign' in args) {\n    delete args['sign']\n  }\n\n  // 字典序排序\n  const keys = Object.keys(args).sort()\n  for (let i = 0; i < keys.length; i++) {\n    const p = keys[i]\n    const k = prefix ? `${prefix}[${p}]` : p\n    const v = args[keys[i]]\n    if (v === '' || v === undefined || v === null) {\n      continue\n    }\n\n    if (typeof v === 'object' && !Array.isArray(v)) {\n      result.push(genSignature(v, signKey, k))\n    } else if (Array.isArray(v)) {\n      v.forEach((item: any, index: number) => {\n        const arrKey = `${k}[${index}]`\n        if (item !== null && typeof item === 'object') {\n          result.push(genSignature(item, signKey, arrKey))\n        } else {\n          result.push(`${encodeURIComponent(arrKey)}=${encodeURIComponent(item)}`)\n        }\n      })\n    } else {\n      result.push(`${encodeURIComponent(k)}=${encodeURIComponent(v)}`)\n    }\n  }\n\n  let payload: Record<string, any> = {}\n  for (const key of keys) {\n    payload[key] = args[key]\n  }\n\n  // 拼接\n  const hash = result.join('&')\n  const signStr = `${hash}&key=${signKey}`\n\n  // md5大写\n  return CryptoJS.MD5(signStr).toString(CryptoJS.enc.Hex).toUpperCase()\n}\n\n/**\n * @method toBase64String\n * @description: 对象转base64\n * @param args\n * @param signKey\n */\nexport const toBase64String = (args: Record<string, any>, signKey: string): string => {\n  // 增加字段\n  if (!('timestamp' in args)) {\n    args = {\n      ...args,\n      timestamp: Math.ceil(new Date().getTime() / 1000).toString()\n    }\n  }\n\n  // 判断是否存在sign\n  if (!('sign' in args)) {\n    args = {\n      ...args,\n      sign: genSignature(args, signKey, '')\n    }\n  }\n\n  const body = JSON.stringify(args)\n  const bytes = CryptoJS.enc.Utf8.parse(body)\n\n  return CryptoJS.enc.Base64.stringify(bytes)\n}\n\n/**\n * @method decryptBase64String\n * @description: base64解密\n * @param value\n */\nexport const decryptBase64String = (value: string): Record<string, any> => {\n  const bytes = CryptoJS.enc.Base64.parse(value)\n  const body = CryptoJS.enc.Utf8.stringify(bytes)\n\n  return JSON.parse(body)\n}\n\n/**\n * @method checkSignature\n * @description: 校验签名\n * @param args\n * @param sign\n * @param signKey\n */\nexport const checkSignature = (args: Record<string, any>, sign: string, signKey: string): boolean => {\n  return genSignature(args, signKey, '') === sign\n}\n\n/**\n * @description [禁用debugger](https://juejin.cn/post/7000784414858805256)\n * @method disableDebugger\n */\nexport const disableDebugger = () => {\n  function block() {\n    setInterval(() => {\n      ;(function () {\n        return false\n      })\n        ['constructor']('debugger')\n        ['call']()\n    }, 50)\n  }\n\n  try {\n    block()\n  } catch (err) {}\n}\n"],"names":["genSignature","args","signKey","prefix","result","keys","Object","sort","i","length","p","k","v","Array","isArray","forEach","item","index","arrKey","push","encodeURIComponent","key","signStr","join","CryptoJS","MD5","toString","enc","Hex","toUpperCase","sign","value","bytes","Base64","parse","body","Utf8","stringify","JSON","setInterval","err","timestamp","Math","ceil","Date","getTime","replace"],"mappings":"wCAQa,MAUAA,EAAe,CAACC,EAA2BC,EAAiBC,EAAS,MAChF,IAAIC,EAAS,GAGT,SAAUH,UACLA,EAAW,KAIpB,MAAMI,EAAOC,OAAOD,KAAKJ,GAAMM,OAC/B,IAAK,IAAIC,EAAI,EAAGA,EAAIH,EAAKI,OAAQD,IAAK,CACpC,MAAME,EAAIL,EAAKG,GACTG,EAAIR,EAAS,GAAGA,KAAUO,KAAOA,EACjCE,EAAIX,EAAKI,EAAKG,IACV,KAANI,SAAYA,IAIC,iBAANA,GAAmBC,MAAMC,QAAQF,GAEjCC,MAAMC,QAAQF,GACvBA,EAAEG,SAAQ,CAACC,EAAWC,KACpB,MAAMC,EAAS,GAAGP,KAAKM,KACV,OAATD,GAAiC,iBAATA,EAC1BZ,EAAOe,KAAKnB,EAAagB,EAAMd,EAASgB,IAExCd,EAAOe,KAAK,GAAGC,mBAAmBF,MAAWE,mBAAmBJ,KACjE,IAGHZ,EAAOe,KAAK,GAAGC,mBAAmBT,MAAMS,mBAAmBR,MAX3DR,EAAOe,KAAKnB,EAAaY,EAAGV,EAASS,IAaxC,CAGD,IAAK,MAAMU,KAAOhB,EACDJ,EAAKoB,GAItB,MACMC,EAAU,GADHlB,EAAOmB,KAAK,YACMrB,IAG/B,OAAOsB,EAASC,IAAIH,GAASI,SAASF,EAASG,IAAIC,KAAKC,aAAa,yBAmDzC,CAAC5B,EAA2B6B,EAAc5B,IAC/DF,EAAaC,EAAMC,EAAS,MAAQ4B,8BAfTC,IAClC,MAAMC,EAAQR,EAASG,IAAIM,OAAOC,MAAMH,GAClCI,EAAOX,EAASG,IAAIS,KAAKC,UAAUL,GAEzC,OAAOM,KAAKJ,MAAMC,EAAK,0BAkBM,KAW7B,IATEI,aAAY,MACT,WACC,OAAO,CACR,GACe,YAAE,YACT,MAAG,GACX,GAKJ,CAAC,MAAOC,GAAO,iDA/DY,CAACvC,EAA2BC,KAElD,cAAeD,IACnBA,EAAO,IACFA,EACHwC,UAAWC,KAAKC,MAAK,IAAIC,MAAOC,UAAY,KAAMnB,aAKhD,SAAUzB,IACdA,EAAO,IACFA,EACH6B,KAAM9B,EAAaC,EAAMC,EAAS,MAItC,MAAMiC,EAAOG,KAAKD,UAAUpC,GACtB+B,EAAQR,EAASG,IAAIS,KAAKF,MAAMC,GAEtC,OAAOX,EAASG,IAAIM,OAAOI,UAAUL,EAAM,yBAnFdD,GACtBA,EAAMF,cAAciB,QAAQ,aAAc"}