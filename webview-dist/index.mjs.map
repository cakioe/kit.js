{"version":3,"file":"index.mjs","sources":["../webview-src/index.ts"],"sourcesContent":["import CryptoJS from 'crypto-js'\n\n/**\n * @method toConstantCase\n * @description: 切换为常量命名\n * @example: `can.i.reset.merchant_config.app_secret` => `CAN_I_RESET_MERCHANT_CONFIG_APP_SECRET`\n * @param value\n */\nexport const toConstantCase = (value: string): string => {\n  return value.toUpperCase().replace(/[^A-Z0-9]/g, '_')\n}\n\n/**\n * @method genSignature\n * @description: 生成签名\n * @param args\n * @param signKey\n */\nexport const genSignature = (args: Record<string, any>, signKey: string): string => {\n  // 删除签名 `sign`\n  if ('sign' in args) {\n    delete args['sign']\n  }\n\n  // 字典序排序\n  const keys = Object.keys(args).sort()\n\n  let payload: Record<string, any> = {}\n  for (const key of keys) {\n    payload[key] = args[key]\n  }\n\n  // 拼接\n  const hash = Object.keys(payload)\n    .map(key => `${key}=${payload[key]}`)\n    .join('&')\n  const signStr = `${hash}&key=${signKey}`\n\n  // md5大写\n  return CryptoJS.MD5(signStr).toString(CryptoJS.enc.Hex).toUpperCase()\n}\n\n/**\n * @method toBase64String\n * @description: 对象转base64\n * @param args\n * @param signKey\n */\nexport const toBase64String = (args: Record<string, any>, signKey: string): string => {\n  // 增加字段\n  if (!('timestamp' in args)) {\n    args = {\n      ...args,\n      timestamp: Math.ceil(new Date().getTime() / 1000).toString()\n    }\n  }\n\n  // 值转成字符串\n  let source: Record<string, any> = {}\n  Object.keys(args).forEach(key => {\n    source[key] = String(args[key])\n  })\n\n  // 判断是否存在sign\n  if (!('sign' in source)) {\n    source = {\n      ...source,\n      sign: genSignature(source, signKey)\n    }\n  }\n\n  const body = JSON.stringify(source)\n  const bytes = CryptoJS.enc.Utf8.parse(body)\n\n  return CryptoJS.enc.Base64.stringify(bytes)\n}\n\n/**\n * @method decryptBase64String\n * @description: base64解密\n * @param value\n */\nexport const decryptBase64String = (value: string): Record<string, any> => {\n  const bytes = CryptoJS.enc.Base64.parse(value)\n  const body = CryptoJS.enc.Utf8.stringify(bytes)\n\n  return JSON.parse(body)\n}\n\n/**\n * @method checkSignature\n * @description: 校验签名\n * @param args\n * @param sign\n * @param signKey\n */\nexport const checkSignature = (args: Record<string, any>, sign: string, signKey: string): boolean => {\n  return genSignature(args, signKey) === sign\n}\n"],"names":["toConstantCase","value","toUpperCase","replace","genSignature","args","signKey","keys","Object","sort","payload","key","signStr","map","join","CryptoJS","MD5","toString","enc","Hex","toBase64String","timestamp","Math","ceil","Date","getTime","source","forEach","String","sign","body","JSON","stringify","bytes","Utf8","parse","Base64","decryptBase64String","checkSignature"],"mappings":"yBAQa,MAAAA,EAAkBC,GACtBA,EAAMC,cAAcC,QAAQ,aAAc,KAStCC,EAAe,CAACC,EAA2BC,KAElD,SAAUD,UACLA,EAAW,KAIpB,MAAME,EAAOC,OAAOD,KAAKF,GAAMI,OAE/B,IAAIC,EAA+B,CAAA,EACnC,IAAK,MAAMC,KAAOJ,EAChBG,EAAQC,GAAON,EAAKM,GAItB,MAGMC,EAAU,GAHHJ,OAAOD,KAAKG,GACtBG,KAAIF,GAAO,GAAGA,KAAOD,EAAQC,OAC7BG,KAAK,YACuBR,IAG/B,OAAOS,EAASC,IAAIJ,GAASK,SAASF,EAASG,IAAIC,KAAKjB,aAAa,EAS1DkB,EAAiB,CAACf,EAA2BC,KAElD,cAAeD,IACnBA,EAAO,IACFA,EACHgB,UAAWC,KAAKC,MAAK,IAAIC,MAAOC,UAAY,KAAMR,aAKtD,IAAIS,EAA8B,CAAA,EAClClB,OAAOD,KAAKF,GAAMsB,SAAQhB,IACxBe,EAAOf,GAAOiB,OAAOvB,EAAKM,GAAK,IAI3B,SAAUe,IACdA,EAAS,IACJA,EACHG,KAAMzB,EAAasB,EAAQpB,KAI/B,MAAMwB,EAAOC,KAAKC,UAAUN,GACtBO,EAAQlB,EAASG,IAAIgB,KAAKC,MAAML,GAEtC,OAAOf,EAASG,IAAIkB,OAAOJ,UAAUC,EAAM,EAQhCI,EAAuBpC,IAClC,MAAMgC,EAAQlB,EAASG,IAAIkB,OAAOD,MAAMlC,GAClC6B,EAAOf,EAASG,IAAIgB,KAAKF,UAAUC,GAEzC,OAAOF,KAAKI,MAAML,EAAK,EAUZQ,EAAiB,CAACjC,EAA2BwB,EAAcvB,IAC/DF,EAAaC,EAAMC,KAAauB"}